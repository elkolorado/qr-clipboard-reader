function ensureJsQRLoaded(){return new Promise((e=>{window.jsQR?e():window.addEventListener("load",(function t(){window.jsQR&&(window.removeEventListener("load",t),e())}))}))}function setTheme(e){document.documentElement.setAttribute("data-theme",e?"dark":"light"),themeToggle.innerHTML=e?'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\n            <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />\n        </svg>':'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\n            <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd" />\n        </svg>';const t=new Date;t.setFullYear(t.getFullYear()+1),document.cookie=`theme=${e?"dark":"light"}; expires=${t.toUTCString()}; path=/`}function loadTheme(){const e=document.cookie.split("; ").find((e=>e.startsWith("theme=")));if(e)setTheme("dark"===e.split("=")[1]);else{setTheme(window.matchMedia("(prefers-color-scheme: dark)").matches)}}function showLinkConfirmation(e){return new Promise((t=>{const n=document.getElementById("linkPopup"),o=n.querySelector(".link-display"),a=n.querySelector(".confirm"),i=n.querySelector(".cancel");o.textContent=e,n.classList.add("popup-show");const s=()=>{c(),t(!0)},r=()=>{c(),t(!1)},d=e=>{e.target===n&&r()},c=()=>{n.classList.remove("popup-show"),a.removeEventListener("click",s),i.removeEventListener("click",r),n.removeEventListener("click",d)};a.addEventListener("click",s),i.addEventListener("click",r),n.addEventListener("click",d)}))}function isValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}async function copyToClipboard(e){try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.error("Failed to copy text: ",e),!1}}function showResult(e,t=!0){result.innerHTML=e,result.className=t?"success":"error",result.style.opacity="0.7",setTimeout((()=>{result.style.opacity="1"}),100)}async function handleQRContent(e,t){if(showResult(`\n        <div class="result-container">\n            <img src="${t}" class="detected-image" alt="Detected QR Code">\n            <div>\n                QR Code detected!<br>\n                Content:<br>\n                <strong>${e}</strong>\n            </div>\n        </div>\n    `,!0),autoActionCheckbox.checked)if(isValidUrl(e)){await showLinkConfirmation(e)&&(window.open(e,"_blank"),showResult(`\n                    <div class="result-container">\n                        <img src="${t}" class="detected-image" alt="Detected QR Code">\n                        <div>\n                            QR Code detected!<br>\n                            Content:<br>\n                            <strong>${e}</strong><br><br>\n                            (Link opened in new tab)\n                        </div>\n                    </div>\n                `,!0))}else{await copyToClipboard(e)&&(result.classList.add("copied"),showResult(`\n                    <div class="result-container">\n                        <img src="${t}" class="detected-image" alt="Detected QR Code">\n                        <div>\n                            QR Code detected!<br>\n                            Content:<br>\n                            <strong>${e}</strong><br><br>\n                            (Copied to clipboard!)\n                        </div>\n                    </div>\n                `,!0),setTimeout((()=>result.classList.remove("copied")),1500))}setTimeout((()=>{URL.revokeObjectURL(t)}),1e3)}async function processImage(e){await ensureJsQRLoaded();const t=URL.createObjectURL(e),n=new Image;n.onload=()=>{const e=document.getElementById("canvas");e.width=n.width,e.height=n.height;const o=e.getContext("2d");o.drawImage(n,0,0);const a=o.getImageData(0,0,e.width,e.height),i=jsQR(a.data,a.width,a.height);i?handleQRContent(i.data,t):(showResult("No QR code found in the image",!1),URL.revokeObjectURL(t))},n.src=t}document.addEventListener("DOMContentLoaded",(()=>{loadTheme(),themeToggle.addEventListener("click",(()=>{setTheme(!("dark"===document.documentElement.getAttribute("data-theme")))})),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{document.cookie.includes("theme=")||setTheme(e.matches)})),document.addEventListener("paste",(async e=>{e.preventDefault();const t=e.clipboardData.items;for(const e of t)if(-1!==e.type.indexOf("image")){const t=e.getAsFile();return void await processImage(t)}showResult("No image found in clipboard. Please copy an image first.",!1)}))}));